<div class="container">
  <div class="input-group">
    <!-- Quantidade (campo reativo) -->
    <div class="form-field quantity-field">
      <label for="count">Quantidade</label>
      <input
        id="count"
        type="number"
        min="1"
        [formControl]="countControl"
        (blur)="countControl.markAsTouched()"
        placeholder="1"
      />
      <div class="field-error" *ngIf="countControl.touched">
        @if (countControl.hasError('min')) {
        <div>Deve ser maior que 0</div>
        } @if (countControl.hasError('required')) {
        <div>Quantidade √© obrigat√≥ria</div>
        }
      </div>
    </div>

    <!-- Bot√£o refresh/scanner -->
    <button
      class="icon-button refresh-scan"
      (click)="startScanner()"
      aria-label="Recarregar scanner"
      [disabled]="isSending"
      title="Recarregar scanner"
    >
      üîÑ
    </button>
  </div>

  <!-- V√≠deo -->
  <div class="video-container">
    <video #videoElement autoplay playsinline muted></video>
    <div class="scan-feedback">{{ scanFeedback }}</div>
  </div>

  <!-- Enviar c√≥digos -->
  <button
    class="primary-btn send-codes"
    (click)="openModal()"
    [disabled]="scannedBarcodes.length === 0 || isSending"
    aria-label="Enviar c√≥digos escaneados"
  >
    Enviar c√≥digos ({{ scannedBarcodes.length }})
  </button>

  <!-- Inserir c√≥digo manual -->
  <div class="manual-barcode-field">
    <label for="manualBarcode">Digite o c√≥digo manualmente</label>
    <div class="manual-input-row">
      <input
        id="manualBarcode"
        type="text"
        placeholder="Ex: 7891234567890"
        [(ngModel)]="manualBarcode"
        (keyup.enter)="addManualBarcode()"
      />
      <button
        class="icon-button"
        (click)="addManualBarcode()"
        title="Adicionar c√≥digo manual"
      >
        ‚ûï
      </button>
    </div>
  </div>
</div>

<!-- Modal custom (overlay) -->
<div class="overlay" *ngIf="showModal">
  <div class="modal">
    <h3>Escolha o arquivo para salvar os c√≥digos</h3>

    <p>Arquivos existentes:</p>
    <div class="file-list">
      @for (file of scannedFiles; track $index) {
      <label class="file-radio">
        <input
          type="radio"
          name="selectedFile"
          [value]="file.filename"
          [(ngModel)]="selectedFilename"
        />
        {{ file.filename }}
      </label>
      } @if (scannedFiles.length === 0) {
      <div class="no-files">Nenhum arquivo encontrado</div>
      }

    <p>Ou crie um arquivo novo:</p>
    <div class="form-field new-name-field">
      <label for="newFilename">Novo nome de arquivo (ex: produtos)</label>
      <input
        id="newFilename"
        type="text"
        placeholder="Novo nome de arquivo"
        [formControl]="newFilenameControl"
      />

      @if (newFilenameControl.touched && newFilenameControl.invalid) {
         <div
        class="field-error"></div>
      }

        @if (newFilenameControl.hasError('required')) {
        <div>Nome do arquivo √© obrigat√≥rio</div>
        }
      </div>
    </div>

    <div class="modal-buttons">
      <button
        class="primary-btn"
        (click)="confirmSend()"
        [disabled]="isSending"
      >
        Confirmar envio
      </button>
      <button class="ghost-btn" (click)="closeModal()" [disabled]="isSending">
        Cancelar
      </button>
    </div>
  </div>
</div>
