<div class="container">
  <div class="input-group">
    <div class="form-field quantity-field">
      <label for="count">Quantidade</label>
      <input
        id="count"
        type="number"
        min="1"
        [formControl]="countControl"
        (blur)="countControl.markAsTouched()"
        placeholder="1"
      />
      @if (countControl.touched) {
      <div class="field-error">
        @if (countControl.hasError('min')) {
        <div>Deve ser maior que 0</div>
        } @if (countControl.hasError('required')) {
        <div>Quantidade é obrigatória</div>
        }
      </div>
      }
    </div>

    <button
      class="icon-button refresh-scan"
      (click)="startScanner()"
      aria-label="Recarregar scanner"
      [disabled]="isSending"
      title="Recarregar scanner"
    >
      <img ngSrc="/refresh.png" width="20" height="20" />
    </button>
  </div>

  <div class="video-container">
    <video #videoElement autoplay playsinline muted></video>
    <div class="scan-feedback">{{ scanFeedback }}</div>
  </div>

  <button
    class="primary-btn send-codes"
    (click)="openModal()"
    [disabled]="scannedBarcodes.length === 0 || isSending"
    aria-label="Enviar códigos escaneados"
  >
    Enviar códigos ({{ scannedBarcodes.length }})
  </button>

  <div class="manual-barcode-field">
    <div class="manual-input-wrapper">
      <input
        id="manualBarcode"
        type="text"
        placeholder="Ex: 7891234567890"
        [(ngModel)]="manualBarcode"
        (keyup.enter)="addManualBarcode()"
      />
      <button
        class="icon-button inside-input"
        (click)="addManualBarcode()"
        title="Adicionar código manual"
      >
        <img ngSrc="add.png" width="15" height="15" alt="" />
      </button>
    </div>
  </div>
</div>
@if (showModal) {
<div class="overlay">
  <div class="modal">
    <h3>Escolha o arquivo para salvar os códigos</h3>

    <p>Arquivos existentes:</p>
    <div class="file-list">
      @for (file of scannedFiles; track $index) {
      <label class="file-radio">
        <input
          type="radio"
          name="selectedFile"
          [value]="file.filename"
          [(ngModel)]="selectedFilename"
        />
        {{ file.filename }}
      </label>
      } @if (scannedFiles.length === 0) {
      <div class="no-files">Nenhum arquivo encontrado</div>
      }

      <p>Ou crie um arquivo novo:</p>
      <div class="form-field new-name-field">
        <label for="newFilename">Novo nome de arquivo (ex: produtos)</label>
        <input
          id="newFilename"
          type="text"
          placeholder="Novo nome de arquivo"
          [formControl]="newFilenameControl"
        />

        @if (newFilenameControl.touched && newFilenameControl.invalid) {
        <div class="field-error"></div>
        } @if (newFilenameControl.hasError('required')) {
        <div>Nome do arquivo é obrigatório</div>
        }
      </div>
    </div>

    <div class="modal-buttons">
      <button
        class="primary-btn"
        (click)="confirmSend()"
        [disabled]="isSending"
      >
        Confirmar envio
      </button>
      <button class="ghost-btn" (click)="closeModal()" [disabled]="isSending">
        Cancelar
      </button>
    </div>
  </div>
</div>

}
